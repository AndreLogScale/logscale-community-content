name: Kubelet Logs
timeSelector: {}
sharedTimeInterval:
  enabled: false
  isLive: false
  start: 1d
widgets:
  3bed5b7d-4c1e-444f-9d6b-78691014fe81:
    x: 4
    y: 6
    description: Log Event Count by Kubelet Go Module
    height: 5
    queryString: |-
      source=systemd SYSLOG_IDENTIFIER=kubelet hostname=?hostname MESSAGE=*
      | regex("^(?<syslog_header>[^\"]+)\"(?<syslog_message>[^\"]+)\"(?<syslog_message_kv>.+)",field=MESSAGE)
      | regex("^(?<msgid>\S+)\s(?<mtime>\S+)\s+(?<mn>\d+)\s(?<goref>[_a-z0-9]+\.go:\d+)\]",field=syslog_header)
      | regex("^(?<gomodule>[^:]+):(?<goline>\d+)",field=goref)
      | case { msgid = "I*" | msg_severity := "INFO";
             msgid = "W*" | msg_severity := "WARN";
             msgid = "E*" | msg_severity := "ERROR";
                        * | msg_severity := "UNKNOWN"}
      | rename(field=msg_severity, as=severity)
      | groupBy([gomodule], function=[count()])
    end: now
    start: 5m
    width: 5
    options:
      valuesOnBars: true
      xAxisTitle: file
      barChartType: grouped
      yAxisTitle: count
      labelAlign: right
    visualization: bar-chart
    title: Summary - Event Count by Go Module
    isLive: false
    type: query
  aebb806b-213e-4453-a4e6-f76966286912:
    x: 0
    y: 0
    description: kubelet log event count
    height: 6
    queryString: |-
      source=systemd SYSLOG_IDENTIFIER=kubelet hostname=?hostname
      | regex("^(?<syslog_header>[^\"]+)\"(?<syslog_message>[^\"]+)\"(?<syslog_message_kv>.+)",field=MESSAGE)
      | regex("^(?<msgid>\S+)\s(?<mtime>\S+)\s+(?<mn>\d+)\s(?<goref>[_a-z0-9]+\.go:\d+)\]",field=syslog_header)
      | case { msgid = "I*" | msg_severity := "INFO";
             msgid = "W*" | msg_severity := "WARN";
             msgid = "E*" | msg_severity := "ERROR";
             * | msg_severity := "UNKNOWN"}
      | msg_severity=?severity
      | timeChart(span=5m)
    end: now
    start: 6h
    width: 3
    options:
      default: {}
    visualization: single-value
    title: Event Count
    isLive: false
    type: query
  dae7d745-fbbc-49db-9d7a-0079f282c0f2:
    x: 6
    y: 0
    description: kubelet process status
    height: 6
    queryString: |-
      source=process hostname=* proc_name=containerd
      | groupBy([hostname, proc_name, alive])
      | case { alive =  "true" | proc_status := "RUNNING";
               alive = "false" | proc_status := "DOWN";
               *               | proc_status := "UNKNOWN"}
      | sankey(source=proc_status, target=hostname, weight=count())
    end: now
    start: 1m
    width: 2
    options:
      series:
        DOWN:
          color: '#C50D0D'
        RUNNING:
          color: '#08AA1B'
    visualization: sankey
    title: Kubelet - Process Run State
    isLive: false
    type: query
  081e107a-7bef-49b3-bc51-0662aff6c4ba:
    x: 0
    y: 11
    description: Kubelet Log Event Messages
    height: 6
    queryString: |-
      source=systemd SYSLOG_IDENTIFIER=kubelet hostname=?hostname
      | regex(regex=?regex,field=MESSAGE)
      | regex("^(?<syslog_header>[^\"]+)\"(?<message>[^\"]+)\"(?<details>.+)",field=MESSAGE)
      | regex("^(?<msgid>\S+)\s(?<mtime>\S+)\s+(?<mn>\d+)\s(?<goref>[_a-z0-9]+\.go:\d+)\]",field=syslog_header)
      | regex("^(?<go_module>[^:]+):(?<goline>\d+)",field=goref)
      | go_module=?go_module
      | case { msgid = "I*" | msg_severity := "INFO";
               msgid = "W*" | msg_severity := "WARN";
               msgid = "E*" | msg_severity := "ERROR";
               *            | msg_severity := "UNKNOWN"}
      | rename(field=msg_severity, as=severity)
      | severity=?severity
      | groupBy([@timestamp, gg, go_regex, hostname, severity, msgid, go_module, message, details],function=[])
    visualization: table-view
    end: now
    start: 1m
    width: 12
    title: Log Events
    isLive: false
    type: query
  3d335c6b-7cd0-4f67-892d-b1fff09601ab:
    x: 3
    y: 0
    description: Message Severity Count
    height: 6
    queryString: |-
      source=systemd SYSLOG_IDENTIFIER=kubelet hostname=?hostname
      | regex("^(?<syslog_header>[^\"]+)\"(?<syslog_message>[^\"]+)\"(?<syslog_message_kv>.+)",field=MESSAGE)
      | regex("^(?<msgid>\S+)\s(?<mtime>\S+)\s+(?<mn>\d+)\s(?<goref>[_a-z0-9]+\.go:\d+)\]",field=syslog_header)
      | regex("^(?<gofile>[^:]+):(?<goline>\d+)",field=goref)
      | gofile=?go_module
      | case { msgid = "I*" | msg_severity := "INFO";
             msgid = "W*" | msg_severity := "WARN";
             msgid = "E*" | msg_severity := "ERROR";
             * | msg_severity := "UNKNOWN"}
      | msg_severity=?severity
      | timeChart(series=msg_severity)
    end: now
    start: 6h
    width: 3
    options:
      gradient: true
      connect-points: false
      stacking: normal
      yAxisScale: linear
      plotType: area
      regression: true
      imputation: none
    visualization: time-chart
    title: Timechart - Message Severity
    isLive: false
    type: query
  b51dcb4a-11ae-4889-a8b9-051e0276b611:
    x: 8
    y: 0
    description: containerd process status
    height: 6
    queryString: |-
      source=process hostname=* proc_name=containerd
      | groupBy([hostname, proc_name, alive])
      | case { alive =  "true" | proc_status := "RUNNING";
               alive = "false" | proc_status := "DOWN";
               *               | proc_status := "UNKNOWN"}
      | sankey(source=proc_status, target=hostname, weight=count())
    end: now
    start: 1m
    width: 2
    options:
      series:
        DOWN:
          color: '#C50D0D'
        RUNNING:
          color: '#08AA1B'
      showAxes: false
    visualization: sankey
    title: Containerd - Process Run State
    isLive: false
    type: query
  532aa681-9153-43ae-8e96-e65cc6d6834e:
    x: 0
    y: 6
    description: Kublet Go Modules Logging Messages
    height: 5
    queryString: |-
      source=systemd SYSLOG_IDENTIFIER=kubelet hostname=?hostname
      | regex("^(?<syslog_header>[^\"]+)\"(?<syslog_message>[^\"]+)\"(?<syslog_message_kv>.+)",field=MESSAGE)
      | regex("^(?<msgid>\S+)\s(?<mtime>\S+)\s+(?<mn>\d+)\s(?<goref>[_a-z0-9]+\.go:\d+)\]",field=syslog_header)
      | regex("^(?<gomodule>[^:]+):(?<goline>\d+)",field=goref)
      | case { msgid = "I*" | msg_severity := "INFO";
             msgid = "W*" | msg_severity := "WARN";
             msgid = "E*" | msg_severity := "ERROR";
             * | msg_severity := "UNKNOWN"}
      | msg_severity=?severity
      | groupBy([gomodule],function=[count()])
    end: now
    start: 5m
    width: 4
    options:
      innerRadius: 40
    visualization: pie-chart
    title: Summary - Go Modules
    isLive: false
    type: query
  3ec7517f-84f0-4805-aa71-fd24b17a3158:
    x: 9
    y: 6
    description: Kubelet Log Event Severity
    height: 5
    queryString: |-
      source=systemd SYSLOG_IDENTIFIER=kubelet hostname=?hostname
      | regex("^(?<syslog_header>[^\"]+)\"(?<syslog_message>[^\"]+)\"(?<syslog_message_kv>.+)",field=MESSAGE)
      | regex("^(?<msgid>\S+)\s(?<mtime>\S+)\s+(?<mn>\d+)\s(?<goref>[_a-z0-9]+\.go:\d+)\]",field=syslog_header)
      | regex("^(?<gomodule>[^:]+):(?<goline>\d+)",field=goref)
      | gomodule=?go_module
      | case { msgid = "I*" | msg_severity := "INFO";
               msgid = "W*" | msg_severity := "WARN";
               msgid = "E*" | msg_severity := "ERROR";
               *            | msg_severity := "UNKNOWN"}
      | groupBy([msg_severity],function=[count()])
    end: now
    start: 5m
    width: 3
    options:
      innerRadius: 40
    visualization: pie-chart
    title: Summary - Event Severity
    isLive: false
    type: query
  d33cdad5-6810-4a1a-9ff5-68a8d1a3dd8c:
    x: 10
    y: 0
    description: dockerd process status
    height: 6
    queryString: |-
      source=process hostname=* proc_name=containerd
      | groupBy([hostname, proc_name, alive])
      | case { alive = "true"  | proc_status := "RUNNING";
               alive = "false" | proc_status := "DOWN";
               *               | proc_status := "UNKNOWN"}
      | sankey(source=proc_status, target=hostname, weight=count())
    end: now
    start: 1m
    width: 2
    options:
      series:
        DOWN:
          color: '#C50D0D'
        RUNNING:
          color: '#08AA1B'
    visualization: sankey
    title: Dockerd - Process Run State
    isLive: false
    type: query
$schema: https://schemas.humio.com/dashboard/v0.8.0
parameters:
  go_module:
    isMultiParam: false
    label: Go Module
    valueFilters: {}
    fileName: kubelet_go_modules.csv
    type: file
    defaultValue: '*'
    order: 50
    valueField: go_module
  hostname:
    isMultiParam: false
    label: Hostname
    valueFilters: {}
    fileName: k8s_hostnames.csv
    type: file
    defaultValue: '*'
    order: 50
    valueField: hostname
  regex:
    isMultiParam: false
    label: Regex
    order: 50
    type: text
  severity:
    isMultiParam: false
    label: Severity
    order: 50
    values:
    - '*'
    - INFO
    - WARN
    - ERROR
    type: list
    defaultValue: '*'
